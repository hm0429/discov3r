(()=>{const e="https://us-central1-discov3r.cloudfunctions.net",t=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{inputs:[{internalType:"bytes",name:"signature",type:"bytes"}],name:"createAccount",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"image",type:"string"},{internalType:"string",name:"latitude",type:"string"},{internalType:"string",name:"longitude",type:"string"},{internalType:"bytes32",name:"keyHash",type:"bytes32"}],name:"createTreasure",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"image",type:"string"},{internalType:"string",name:"latitude",type:"string"},{internalType:"string",name:"longitude",type:"string"},{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes32",name:"keyHash",type:"bytes32"}],name:"createTreasureERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"image",type:"string"},{internalType:"string",name:"latitude",type:"string"},{internalType:"string",name:"longitude",type:"string"},{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes32",name:"keyHash",type:"bytes32"}],name:"createTreasureERC721",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"treasureId",type:"uint256"},{internalType:"string",name:"key",type:"string"}],name:"discover",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"setTreasureBoxContract",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"signer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"treasureBox",outputs:[{internalType:"contractTreasureBox",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"treasureId",type:"uint256"},{internalType:"string",name:"uuid",type:"string"}],name:"unlockTreasureBox",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"verified",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],n=[{inputs:[{internalType:"address",name:"main",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"approved",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"operator",type:"address"},{indexed:!1,internalType:"bool",name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!0,internalType:"uint256",name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"MAIN_CONTRACT_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"approve",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"didDiscover",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"exists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"getTreasure",outputs:[{components:[{internalType:"address",name:"creator",type:"address"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"image",type:"string"},{internalType:"string",name:"latitude",type:"string"},{internalType:"string",name:"longitude",type:"string"},{internalType:"bytes32",name:"keyHash",type:"bytes32"},{internalType:"enumITreasure.TreasureType",name:"treasureType",type:"uint8"},{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bool",name:"isDiscovered",type:"bool"}],internalType:"structITreasure.Treasure",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"creator",type:"address"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"image",type:"string"},{internalType:"string",name:"latitude",type:"string"},{internalType:"string",name:"longitude",type:"string"},{internalType:"bytes32",name:"keyHash",type:"bytes32"},{internalType:"enumITreasure.TreasureType",name:"treasureType",type:"uint8"},{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bool",name:"isDiscovered",type:"bool"}],internalType:"structITreasure.Treasure",name:"treasure",type:"tuple"}],name:"mint",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],name:"safeTransferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"operator",type:"address"},{internalType:"bool",name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"treasures",outputs:[{internalType:"address",name:"creator",type:"address"},{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"image",type:"string"},{internalType:"string",name:"latitude",type:"string"},{internalType:"string",name:"longitude",type:"string"},{internalType:"bytes32",name:"keyHash",type:"bytes32"},{internalType:"enumITreasure.TreasureType",name:"treasureType",type:"uint8"},{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"bool",name:"isDiscovered",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],a={"0x89":[{chainId:"0x89",chainName:"Polygon",rpcUrls:["https://polygon-rpc.com/"],nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://polygonscan.com/"]}],"0x13881":[{chainId:"0x13881",chainName:"Mumbai",rpcUrls:["https://rpc-mumbai.matic.today/"],nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://mumbai.polygonscan.com/"]}]},i=e=>{e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?null:decodeURIComponent(t[1].replace(/\+/g," "))};function s(){$("#loading ,#spinner").height($(window).height()).css("display","block")}function r(){$("#loading ,#spinner").height($(window).height()).css("display","none")}async function o(){if(ethereum.selectedAddress){if($("#address-label").text(ethereum.selectedAddress.substr(0,5)+"..."+ethereum.selectedAddress.slice(-4)),$(".only-logout").hide(),$(".only-login").show(),await async function(){return await window.contract.verified(ethereum.selectedAddress)}()?($("#address-label").text("✅ "+$("#address-label").text()),$("#button-create-account-modal").hide(),$("#button-create-tb-modal").show()):($("#button-create-account-modal").show(),$("#button-create-tb-modal").hide()),window.tbId&&window.key){$("#d-id").val(tbId),$("#d-key").val(key);const e=window.tbs[tbId];$("#d-name").val(e.name),$("#d-amount").val(ethers.utils.formatEther(e.amount)),$("#d-discovered").val(e.isDiscovered),$("#modal-discover").modal("show")}}else $("#address-label").text(""),$(".only-logout").show(),$(".only-login").hide()}function p(e){return{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)}}async function y(){const e=new ethers.providers.Web3Provider(window.ethereum,"any");return await e.send("eth_requestAccounts",[]),e.getSigner()}async function u(){console.log("onWalletConnect"),await async function(){return await window.ethereum.request({method:"eth_chainId"})}()!==window.chainId&&await l(window.chainId).catch((async e=>{await async function(e){await window.ethereum.request({method:"wallet_addEthereumChain",params:e})}(a[window.chainId]),await l()})),await async function(){const e=await y();window.contract=new ethers.Contract("0xE644dA4785d4a0632ea4815699648bf810412AE4",t,e),window.tb=new ethers.Contract("0x6f3282a794DbD109431e9985A67D7c5dcBFdd7c5",n,e)}(),await async function(){const e=(await window.tb.totalSupply()).toNumber();window.tbs=[];for(let t=0;t<=e;t++){const e=await window.tb.treasures(t);tbs.push({...e,id:t})}}(),await void(window.tbs.length<1||(window.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:37.8029308,lng:-122.4484231}}),window.tbs.forEach(((e,t)=>{e.latitude&&e.longitude&&function(e,t){new google.maps.Marker({position:p(t),map:e,animation:google.maps.Animation.DROP})}(window.map,e)})),$("#map-container").show())),await async function(){worldID.init("world-id-container",{debug:!0,enable_telemetry:!0,action_id:"wid_staging_0fa2dbde7735834e560fb5ad13146f0c",signal:ethereum.selectedAddress,on_success:e=>{console.log(e),window.worldIdProof=e},on_error:e=>console.error(e)})}(),o(),r()}function d(){ethereum.selectedAddress?u():async function(){console.log("onWalletDisconnect"),o()}()}async function l(e){await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:e}]})}async function m(){if(console.log("onClickButtonConnectWallet"),void 0===window.ethereum){if(window.confirm("Open Discov3r in the MetaMask app?"))return void function(){const e=`https://metamask.app.link/dapp/${location.hostname}${location.pathname}${location.search}`;location.href=e}();alert("MetaMask should be installed.")}s(),(await ethereum.request({method:"eth_requestAccounts"}))[0]&&u()}async function c(){window.worldIdProof||(window.worldIdProof="dummy"),s();const t=(await async function(t){return n=`${e}/challenge?address=${t}`,new Promise(((e,t)=>{$.ajax({url:n,type:"GET",async:!0,contentType:"application/json",dataType:"json"}).then((t=>e(t)),(e=>t(e)))}));var n}(ethereum.selectedAddress)).challenge;console.log(t);const n=ethers.utils.solidityKeccak256(["string"],[t]),a=await y(),i=await a.signMessage(ethers.utils.arrayify(n));console.log(i);const o=(await async function(t,n){const a=`${e}/signature`;return new Promise(((e,i)=>{$.ajax({url:a,data:JSON.stringify({address:t,signature:n,worldIdProof:window.worldIdProof}),type:"POST",async:!0,contentType:"application/json",dataType:"json"}).then((t=>e(t)),(e=>i(e)))}))}(ethereum.selectedAddress,i)).signature;console.log(o);const p=await window.contract.createAccount(o);console.log(p),r()}async function w(){const e=$("#i-name").val(),t=$("#i-lat").val(),n=$("#i-lon").val(),a=$("#i-amount").val(),i=$("#i-key").val(),s=ethers.utils.keccak256(ethers.utils.toUtf8Bytes(i)),r=await window.contract.createTreasure(e,"",t,n,s,{value:ethers.utils.parseEther(a)});console.log(r),alert(`tx sent!: ${r.hash}`)}async function b(){const e=$("#d-id").val(),t=$("#d-key").val(),n=await window.contract.discover(e,t);console.log(n),alert(`tx sent!: ${n.hash}`)}async function T(){console.log(window.tbId),console.log(window.key),console.log(window.uuid);const e=await window.contract.unlockTreasureBox(window.tbId,window.uuid);console.log(e)}$((()=>{!async function(){!async function(){window.chainId="polygon"===i("c")?"0x89":"0x13881",window.tbId=i("t"),window.key=i("k"),window.uuid=i("u")}(),async function(){$("#button-connect-wallet").on("click",m),$("#button-test").on("click",T),$("#button-create-account").on("click",c),$("#button-create-tb").on("click",w),$("#button-discover").on("click",b)}(),async function(){void 0!==window.ethereum&&(await ethereum.request({method:"eth_accounts"}),async function(){ethereum.on("connect",(e=>{})),ethereum.on("accountsChanged",(e=>{d()}))}(),d())}()}()}))})();